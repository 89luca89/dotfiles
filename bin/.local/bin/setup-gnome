#!/bin/sh

EXTENSIONS="
AlphabeticalAppGrid@stuarthayhurst
appindicatorsupport@rgcjonas.gmail.com
"

for extension in $EXTENSIONS; do
	if ! gnome-extensions list | grep --quiet "${extension}"; then
		busctl --user call org.gnome.Shell.Extensions \
			/org/gnome/Shell/Extensions org.gnome.Shell.Extensions \
			InstallRemoteExtension s "${extension}"
	fi
done

dconf reset -f /

dest_folder="$HOME/dotfiles/_desktop/"

# Restore background
cp "$dest_folder/background" ~/.config/background

# Restore gnome settings
cd "${dest_folder}"
for f in  .*.conf; do
	dconf_path="$(echo "${f}" | sed 's/conf//g' | sed 's/\./\//g')"
	dconf load "${dconf_path}" < "${f}"
done
gnome-extensions list --disabled | xargs -I{} sh -c "gnome-extensions enable {} && gnome-extensions disable {}"
