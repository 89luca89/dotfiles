#!/bin/sh

if ! cd "$HOME/dotfiles" > /dev/null; then
	exit 1
fi

for i in $(ls -d */ | grep -vE "^_"); do
	pushd $i >/dev/null
	for j in $(find . | tail -n+2); do
		destfile="$(echo "$j" | sed "s|\./|$HOME/|g")"
		if [ -e "$destfile" ]; then
			# ls -ld $destfile | grep "\->" | cut -d' ' -f9-
			continue
		else
			echo "$destfile"
			ln -sf "$(realpath "$j")" "$destfile"
			sync
			sleep 0.25
		fi
	done
	popd >/dev/null
done

ln -sf "$HOME/Syncthing/conf/.histfile" "$HOME/.histfile"
ln -sfn "$HOME/Syncthing/bin" "$HOME/bin"
cp "$HOME/.local/share/flatpak/exports/share/applications/me.kozec.syncthingtk.desktop" "$HOME/.config/autostart/"
