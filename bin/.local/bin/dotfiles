#!/bin/bash

if ! cd "$HOME/dotfiles" > /dev/null; then
	exit 1
fi

for i in $(ls -d */ | grep -vE "^_"); do
	pushd $i > /dev/null || return
	for j in $(find . -type f); do
		destfile="$(echo "$j" | sed "s|\./|$HOME/|g")"
		if [ ! -L "$destfile" ]; then
			rm -i "$destfile"
		fi
		echo "$destfile"
		mkdir -p "$(dirname "${destfile}")"
		ln -sf "$(realpath "$j")" "$destfile"
	done
	popd > /dev/null || return
done

ln -sf "$HOME/Syncthing/conf/.histfile" "$HOME/.histfile"
ln -sfn "$HOME/Syncthing/bin" "$HOME/bin"
mkdir -p "$HOME/.config/autostart/"
cp "$HOME/.local/share/flatpak/exports/share/applications/me.kozec.syncthingtk.desktop" "$HOME/.config/autostart/"
