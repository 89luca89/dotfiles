filetype off                  " required
call plug#begin('~/.vim/plugged')
" vim tmux navigator
Plug 'christoomey/vim-tmux-navigator'
" utilities
Plug 'vim-airline/vim-airline'                                  " tabs and statusline
Plug 'junegunn/fzf'                                             " fuzzy find all the things
Plug 'junegunn/fzf.vim'                                         " fuzzy find all the things
Plug 'airblade/vim-gitgutter'                                   " +,-,~ on modified lines in git repo
Plug 'sheerun/vim-polyglot'                                     " Lang packs
Plug 'scrooloose/nerdtree'
Plug 'yggdroot/indentline'
" LSP + completion
Plug 'w0rp/ale'                                                 " ALE For langs not supported by LSP
Plug 'neoclide/coc.nvim', {'do': 'yarn install --frozen-lockfile'}
" Snippets
Plug 'sirver/ultisnips'
Plug 'honza/vim-snippets'
Plug 'wellle/tmux-complete.vim'                                 " completion from tmux panes
" Colorschemes
Plug 'flazz/vim-colorschemes'
call plug#end()               " required
filetype plugin indent on     " required
autocmd VimResized * :wincmd =
let g:java_highlight_all=1
let g:python_highlight_all=1
""" Airline -> bufferline
let g:airline#extensions#tabline#enabled = 1
let g:airline#extensions#tabline#formatter = 'unique_tail'
" Ctrl+N relocate file explorer to opened file
let NERDTreeShowHidden=1
noremap <C-\> :NERDTreeToggle<CR>
noremap <C-N> :NERDTreeFind<CR>
" Ctrl+T fuzzy find ctags
" Ctrl+B fuzzy find files
" Ctrl+F grep -r in the folder
" Ctrl+H command history
noremap <C-T> :Tags<CR>
noremap <C-B> :Files<CR>
noremap <C-F> :Rg<CR>
noremap <C-H> :History:<CR>

let g:coc_global_extensions = [ 'coc-json', 'coc-yaml', 'coc-xml', 'coc-go',
                            \ 'coc-python', 'coc-java', 'coc-rls', 'coc-ultisnips' ]

" ALE Linters (for non-lsp langs)
let g:ale_set_loclist = 0
let g:ale_set_quickfix = 1
let g:ale_sign_column_always = 1
let g:ale_linters_explicit = 1
let g:ale_fix_on_save = 1
let g:ale_fixers = {'*':['remove_trailing_lines', 'trim_whitespace'],}
let g:ale_linters = {
            \ 'sh':['shellcheck', 'checkbashisms'],
            \ 'ansible':['ansible-lint'],
            \ 'Dockerfile':['dockerfile_lint']
            \}

let $FZF_DEFAULT_COMMAND="find . -type f -not -path '*/\.git/*' -not -path '*/\bin/*' -not -path '*/\out/*' -not -name '*.exe' -not -name '*.class' -not -name '*.so' -not -name '*.bin' -not -name '*.out'"
let g:fzf_files_options = "--preview 'if file {1} | grep -i text; then pygmentize -g {1} ; fi'"
let g:fzf_tags_command = 'ctags -R'
let g:fzf_action = {'alt-enter':'vsplit' }
" Language client shortcuts with leader:
map <silent> <leader>m :CocList actions<cr>
map <silent> <leader>f :CocFix<cr>
map <silent> <leader>d :CocList diagnostics<cr>
map <silent> <leader>h :call CocAction('doHover')<cr>
map <silent> <leader>r :call CocAction('rename')<cr>
map <silent> <leader>] :call CocAction('jumpDefinition')<cr>
map <silent> <leader>[ :call CocAction('jumpImplementation')<cr>
map <silent> <leader>r :call CocAction('jumpReferences')<cr>
map <silent> <leader>l :call CocAction('format')<cr>
" Ctrl+P loclist
map <silent> <C-P> :<C-u>cw<CR>
" Ctrl+L Format Code
" if not use the specific implementation
noremap <C-L> <Esc>:w<CR>:mkview<CR>ggVG=<CR>:loadview<CR>
augroup autoformat_settings
    autocmd FileType python noremap <buffer> <C-L> <Esc>:w<CR>:mkview<CR>:%!autopep8 %<CR>:loadview<CR>
    autocmd FileType typescript,javascript noremap <buffer> <C-L> <Esc>:w<CR>:mkview<CR>:%!clang-format -style=file %<CR>:loadview<CR>
    autocmd FileType css,json noremap <buffer> <C-L> <Esc>:w<CR>:mkview<CR>:%!jsonlint -f %<CR>:loadview<CR>
    autocmd FileType sh noremap <buffer> <C-L> <Esc>:w<CR>:!beautysh -f %<CR>:e<CR>
    autocmd FileType yaml,ansible noremap <buffer> <C-L> <Esc>:w<CR>:!yamlfmt -w %<CR><CR>
    autocmd FileType c,cpp,java noremap <buffer> <C-L> :call CocAction('format')<CR>
augroup END
" leader y/p to use system clipboard
noremap <Leader>y "+y
noremap <Leader>p "+p
" Toggle Theme
map <silent> <C-e> :<C-u>call ToggleTheme()<CR>
function! ToggleTheme()
    if &background == 'light'
        set background=dark
        colorscheme codedark
    else
        set background=light
        colorscheme eclipse
        hi ColorColumn guibg=#eeeeee
        hi VertSplit guibg=#eeeeee guifg=#aaaaaa
        hi Pmenu guibg=#aaaaaa
    endif
endfunction
""" Tabs Navigation
" navigate tabs Tab (fw) S-Tab (prev)
map <Tab> :bn<CR>
map <S-Tab> :bp<CR>
" Ctrl+C close buffer ( pipe commands to fix behaviour with splits and netrw/nerdtree)
nnoremap <C-c> :bp<bar>sp<bar>bn<bar>bd!<CR>
" " Resize split window horizontally and vertically
noremap <S-M-Up> :2winc+<cr>
noremap <S-M-Down> :2winc-<cr>
noremap <S-M-Left> :2winc><cr>
noremap <S-M-Right> :2winc<<cr>
" vim-tmux-navigator shortcuts
let g:tmux_navigator_no_mappings = 1
nnoremap <silent> <M-Left> :TmuxNavigateLeft<cr>
nnoremap <silent> <M-Down> :TmuxNavigateDown<cr>
nnoremap <silent> <M-Up> :TmuxNavigateUp<cr>
nnoremap <silent> <M-Right> :TmuxNavigateRight<cr>
inoremap <silent> <M-Left> <Esc>:TmuxNavigateLeft<cr>
inoremap <silent> <M-Down> <Esc>:TmuxNavigateDown<cr>
inoremap <silent> <M-Up> <Esc>:TmuxNavigateUp<cr>
inoremap <silent> <M-Right> <Esc>:TmuxNavigateRight<cr>
" Remap Wq to wq to have less typo on exit
cmap Wq wq
set nocompatible                                                  " required
set mouse=a                                                       " it's always useful
set undofile undolevels=1000 undodir=$HOME/.vim/undo              " Undo file and directory
set directory=$HOME/.vim/swap                                     " Custom swapfile directory
set path+=** wildmenu                                             " Recursive path Tab autocomplete
set wildmenu
set lazyredraw ttyfast ttimeoutlen=20                             " Faster redraw
set hidden                                                        " change buffer without saving
set backspace=indent,eol,start                                    " http://vi.stackexchange.com/a/2163
set splitright splitbelow                                         " Open new splits to the right and bottom
set autoindent smartindent                                        " always set autoindenting on
set smarttab expandtab shiftwidth=4 tabstop=4 softtabstop=4       " Four spaces for tabs everywhere
set hlsearch incsearch ignorecase smartcase                       " Highlight search results, ignore case if search is all lowercase
set nowrap number                                                 " play nicely with long lines
set nomodeline                                                    " protect against https://github.com/numirias/security/blob/master/doc/2019-06-04_ace-vim-neovim.md
set signcolumn=yes laststatus=2
let &colorcolumn=join(range(81,999),",")
syntax on
" play nicely with modern graphics
set encoding=utf8
set termguicolors
set background=dark
colorscheme codedark
