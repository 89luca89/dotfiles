# BASIC ALIASES
alias cp='cp --reflink=auto --sparse=always'
alias ll='ls -Ahl --group-directories-first --color'
alias tfswitch="tfswitch -b $HOME/.local/bin/terraform"
alias tree='tree -I ".git" -a'
alias mail='vim /tmp/mail.eml'
alias dbox="distrobox-enter default_distrobox -- bash -l -c 'tmux a || tmux'"
alias wolfi="unset TMUX && distrobox-enter wolfi_distrobox -- bash -l -c 'cd /home/luca-linux/Projects/chainguard/ && tmux a || tmux'"
alias libvirt="DBX_CONTAINER_MANAGER=docker distrobox enter libvirt"
alias vi='vi -u ~/.vimrc-minimal'
if ! type __vte_prompt_command >/dev/null 2>&1; then
	function __vte_prompt_command() {  return; }
fi
export CARGO_HOME=$HOME/.local/rust
export GOPATH=$HOME/.local/share/go
export GOTMPDIR=$HOME/.cache/go-build
export GPG_TTY=$(tty)
export QT_QPA_PLATFORMTHEME=gnome
export RUSTUP_HOME=$HOME/local/share/rust
export RUST_SRC_PATH="$RUSTUP_HOME/toolchains/stable-x86_64-unknown-linux-gnu/lib/rustlib/src/rust/src"
export TMUX_TMPDIR=/var/tmp
export PATH=$HOME/.config/emacs/bin/:$PATH
export PATH=$HOME/.local/bin:$PATH
export PATH=$HOME/.local/share/flatpak/exports/bin:$PATH
export PATH=$HOME/bin:$PATH
export PATH=$PATH:/usr/sbin:/usr/local/sbin
export EDITOR=vim

alias light="echo -n light > ~/.local/share/theme && kill -s USR1 \$(pgrep vim)"
alias dark="echo -n dark > ~/.local/share/theme && kill -s USR1 \$(pgrep vim)"
alias cgwork-create="cg work create --machine-type n4-standard-32 --lifetime 120h --data-disk-type hyperdisk-balanced --boot-disk-type hyperdisk-balanced --zone europe-west2-a"
alias cgwork="gcloud compute ssh  --project chainguard-workstations --zone europe-west2-a luca-dimaio-work-v2 --command \"~/.local/bin/distrobox enter wolfi_distrobox -- sh -c 'tmux a || tmux'\" -- -t"

# Sandboxed claude container for --dangerously-skip-permissions usage.
claude-container() {
	workdir=$(pwd)
	if [ "$workdir" = "$HOME" ]; then
		workdir="$HOME/.claude/scratch"
		mkdir -p "$workdir"
	fi
	PODMAN_SOCK="${XDG_RUNTIME_DIR}/podman/podman.sock"
	if [ ! -S "$PODMAN_SOCK" ]; then
		echo "Starting podman socket..."
		systemctl --user start podman.socket
	fi
	podman run \
		--env TERM="$TERM" --env HOME="$HOME" \
		-e DOCKER_HOST=unix://$PODMAN_SOCK \
		-e CONTAINER_HOST=unix://$PODMAN_SOCK \
		--userns=keep-id --rm -ti \
		--cap-drop=ALL \
		--security-opt label=disable \
		--security-opt no-new-privileges \
		--read-only \
		--memory=4g --cpus=4 --pids-limit=2048 \
		--ulimit core=0:0 \
		--tmpfs /tmp:rw,size=512m \
		--tmpfs /var/tmp:rw,size=512m \
		--tmpfs /run:rw,size=256m \
		--tmpfs /home/"${USER}":rw \
		-v "${PODMAN_SOCK}:${PODMAN_SOCK}:z" \
		-v "$HOME/.claude.json:$HOME/.claude.json:z" \
		-v "$HOME/.claude:$HOME/.claude:z" \
		-v "$workdir:$workdir:z" \
		--workdir "$workdir" \
		localhost/claude:latest "$@"
}
alias claude-code="claude-container --permission-mode plan --dangerously-skip-permissions --append-system-prompt-file $HOME/.claude/coding-prompt.md"
alias claude="claude-container --append-system-prompt-file $HOME/.claude/chat-prompt.md"
